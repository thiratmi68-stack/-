<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô | Medical Queue</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Sarabun', sans-serif;
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen flex flex-col">
  <script>
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö - ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login
    (function () {
      try {
        const user = JSON.parse(localStorage.getItem('mq_user'));
        if (!user || !user.name) {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô');
          window.location.href = 'index.html';
        }
      } catch (e) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô');
        window.location.href = 'index.html';
      }
    })();
  </script>

  <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
      <a href="home.html" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
        <div class="w-9 h-9 rounded-full border border-blue-500 flex items-center justify-center">
          <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M3 12h4l3-6 4 12 3-6h4" />
          </svg>
        </div>
        <div>
          <p class="font-bold text-blue-600 leading-none">Medical Queue</p>
          <p class="text-sm text-gray-500">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
        </div>
      </a>

      <ul class="hidden md:flex gap-10 text-gray-700 font-medium">
        <li>
          <a href="home.html"
            class="border-b-2 border-transparent pb-1 hover:text-blue-600 hover:border-blue-600 transition-colors">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
        </li>
        <li>
          <a href="booking.html"
            class="border-b-2 border-transparent pb-1 hover:text-blue-600 hover:border-blue-600 transition-colors">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ï‡∏£‡∏ß‡∏à</a>
        </li>
        <li>
          <a href="myticket.html"
            class="border-b-2 border-transparent pb-1 hover:text-blue-600 hover:border-blue-600 transition-colors">‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a>
        </li>
        <li>
          <a href="history.html"
            class="border-b-2 border-transparent pb-1 hover:text-blue-600 hover:border-blue-600 transition-colors">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a>
        </li>
        <li>
          <a href="notification.html"
            class="border-b-2 border-blue-600 pb-1 text-blue-600 font-semibold transition-colors">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</a>
        </li>
      </ul>

      <div class="flex items-center gap-4">
        <a id="userStatusLink" href="index.html"
          class="text-blue-600 font-medium hover:underline text-sm md:text-base">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô / ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
        <div id="userMenuBtn"
          class="w-9 h-9 border rounded-full flex items-center justify-center hover:bg-gray-100 cursor-pointer transition-colors bg-white hidden">
          <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
            <circle cx="12" cy="7" r="4" />
          </svg>
        </div>
      </div>
    </div>
  </nav>

  <!-- ----------------------------------------------------------------- -->

  <main class="flex-grow max-w-7xl mx-auto px-6 py-8 w-full">

    <div class="flex items-center justify-between mb-8">
      <h1 class="text-3xl font-bold text-gray-900 flex items-center gap-3">
        <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
        </svg>
        ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
      </h1>
    </div>

    <!-- ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á -->
    <div class="flex gap-2 mb-8 flex-wrap">
      <button class="px-4 py-2 rounded-full bg-blue-600 text-white font-medium text-sm transition"
        data-filter="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      <button class="px-4 py-2 rounded-full bg-gray-200 text-gray-700 font-medium text-sm hover:bg-gray-300 transition"
        data-filter="appointment">‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢</button>
      <button class="px-4 py-2 rounded-full bg-gray-200 text-gray-700 font-medium text-sm hover:bg-gray-300 transition"
        data-filter="reminder">‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥</button>
      <button class="px-4 py-2 rounded-full bg-gray-200 text-gray-700 font-medium text-sm hover:bg-gray-300 transition"
        data-filter="system">‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
    <div class="space-y-4">
      <p class="text-center text-gray-500 py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>

    <!-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
    <div id="emptyState" class="hidden text-center py-16">
      <svg class="w-20 h-20 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
      </svg>
      <p class="text-gray-500 text-xl font-medium">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
      <p class="text-gray-400">‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà</p>
    </div>

  </main>

  <!-- ----------------------------------------------------------------- -->

  <footer class="bg-white border-t border-gray-200 py-6 mt-8">
    <div class="max-w-7xl mx-auto px-6 text-center">
      <p class="text-gray-500 text-sm">&copy; 2024 Medical Queue System. ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
    </div>
  </footer>

  <script>
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    (function () {
      const userStatusLink = document.getElementById('userStatusLink');
      const userMenuBtn = document.getElementById('userMenuBtn');

      try {
        const user = JSON.parse(localStorage.getItem('mq_user'));
        if (user && user.name) {
          userStatusLink.textContent = user.name;
          userStatusLink.href = '#';
          userStatusLink.style.cursor = 'pointer';
          userMenuBtn.classList.remove('hidden');

          userStatusLink.addEventListener('click', function (e) {
            e.preventDefault();
            if (confirm('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?')) {
              localStorage.removeItem('mq_user');
              localStorage.removeItem('mq_registeredUser');
              window.location.reload();
            }
          });
        }
      } catch (e) {
        // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• user ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏Å‡∏ï‡∏¥
      }
    })();

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    (function () {
      const filterBtns = document.querySelectorAll('[data-filter]');
      const container = document.querySelector('.space-y-4'); // container for items
      const emptyState = document.getElementById('emptyState');
      const user = JSON.parse(localStorage.getItem('mq_user') || '{}');
      let allNotifications = [];

      function render(filter) {
        container.innerHTML = '';
        const filtered = allNotifications.filter(n => filter === 'all' || n.type === filter);

        if (filtered.length === 0) {
          emptyState.classList.remove('hidden');
          return;
        }
        emptyState.classList.add('hidden');

        filtered.forEach(n => {
          const el = document.createElement('div');
          el.className = 'notification-item bg-white rounded-xl shadow-sm border p-6 hover:shadow-md transition mb-4';
          el.setAttribute('data-type', n.type);

          // Colors based on type
          let colorClass = 'blue';
          if (n.type === 'reminder') colorClass = 'yellow';
          if (n.type === 'system') colorClass = 'green';
          el.classList.add(`border-${colorClass}-200`);

          el.innerHTML = `
                <div class="flex items-start gap-4">
                    <div class="w-12 h-12 rounded-full bg-${colorClass}-100 flex items-center justify-center flex-shrink-0">
                        <svg class="w-6 h-6 text-${colorClass}-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/> 
                        </svg>
                    </div>
                    <div class="flex-grow">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-lg font-bold text-gray-900">${n.title}</h3>
                                <p class="text-sm text-gray-600 mt-1">${n.message}</p>
                            </div>
                        </div>
                        ${n.date ? `<p class="text-sm text-gray-500 mt-3">üìÖ ${n.date} ${n.time} | üè• ${n.patient_name}</p>` : ''}
                        <p class="text-xs text-gray-400 mt-3">${n.meta || ''}</p>
                    </div>
                </div>
            `;
          container.appendChild(el);
        });
      }

      // Fetch notifications
      const API_BASE = (location.hostname === 'localhost' || location.hostname === '127.0.0.1') ? (location.protocol + '//' + location.hostname + ':5000') : '';
      fetch(API_BASE + '/api/notifications')
        .then(r => r.json())
        .then(list => {
          // Filter by logged in user (or allow system messages for everyone)
          allNotifications = list.filter(n => {
            if (n.type === 'system') return true;
            if (!user.name) return false;
            // Match by patient name loosely or exactly
            return (n.patient_name || '').trim() === user.name.trim();
          });
          render('all');
        })
        .catch(err => {
          console.error(err);
          container.innerHTML = '<p class="text-center text-red-500">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ</p>';
        });


      filterBtns.forEach(btn => {
        btn.addEventListener('click', function () {
          const filter = this.getAttribute('data-filter');

          // Update styles
          filterBtns.forEach(b => {
            b.classList.remove('bg-blue-600', 'text-white');
            b.classList.add('bg-gray-200', 'text-gray-700');
          });
          this.classList.remove('bg-gray-200', 'text-gray-700');
          this.classList.add('bg-blue-600', 'text-white');

          render(filter);
        });
      });
    })();

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    document.getElementById('markAllRead').addEventListener('click', function () {
      const items = document.querySelectorAll('.notification-item');
      items.forEach(item => {
        item.classList.add('opacity-75');
      });
      alert('‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    });
  </script>

</body>

</html>